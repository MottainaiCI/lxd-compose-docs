<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  
  <meta name="description" content="LXD Compose">
  <meta name="author" content="Geaaru">
  <meta name="generator" content="Hugo 0.81.0" />
  
  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <link rel="icon" href="https://mottainaici.github.io/lxd-compose-docs/images/favicon.ico">

  <!-- Twitter Bootstrs CSS -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionicons Fonts Css -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/ionicons/ionicons.min.css">
  <!-- animate css -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/animate-css/animate.css">
  <!-- Hero area slider css-->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.css">
  <!-- slick slider -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.css">
  <!-- Fancybox -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.css">
  <!-- hover -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/hover/hover-min.css">
  <!-- template main css file -->
  
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/style.min.css" media="screen">
  
	<!-- Custom stylesheet - for your changes -->
	
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/custom.min.css" media="screen">
  
</head><head>
  <meta name="generator" content="Hugo 0.81.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="LXD Compose">
  <meta name="author" content="Geaaru">
  <meta name="generator" content="Hugo 0.81.0" />

<!-- Mobile Specific Metas -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<link rel="icon" href="https://mottainaici.github.io/lxd-compose-docs/images/favicon.ico">

<!-- Twitter Bootstrs CSS -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.css">
<!-- Ionicons Fonts Css -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/ionicons/ionicons.min.css">
<!-- animate css -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/animate-css/animate.css">
<!-- Hero area slider css-->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.css">
<!-- slick slider -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.css">
<!-- Fancybox -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.css">
<!-- hover -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/hover/hover-min.css">
<!-- template main css file -->

<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/style.min.css" media="screen">

  
<!-- Custom stylesheet - for your changes -->

<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/custom.min.css" media="screen"><meta property="og:title" content="" />
<meta property="og:description" content="Tutorial #  Hereinafter, how to create your first project in five steps. Enjoy!
Setup LXD Environment #  Step 1: Install LXD #  Ubuntu Linux $&gt; apt-get install lxd-installer $&gt; apt-get install zfsutils-linux $&gt; apt-get install curl In Ubuntu LXD is not available as a single package, but it uses snapd, so lxd-installer is the installer package of LXD. The installation of zfsutils is not mandatory but it prepares the environment if you want to use ZFS with LXD." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mottainaici.github.io/lxd-compose-docs/docs/tutorial/" /><meta property="article:section" content="docs" />

<meta property="og:site_name" content="LXD Compose" />

<title>Tutorial | LXD Compose</title>
<link rel="manifest" href="/lxd-compose-docs/manifest.json">
<link rel="icon" href="/lxd-compose-docs/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/lxd-compose-docs/book.min.fced4329b6e116250f4be38d09e7215f9855a28c8e1914b3337a72505f196dc1.css" integrity="sha256-/O1DKbbhFiUPS&#43;ONCechX5hVooyOGRSzM3pyUF8ZbcE=">
<script defer src="/lxd-compose-docs/en.search.min.1540dec91387bba42d20f24287443e429ef84e6ab1adcb99244b85b13f9f5828.js" integrity="sha256-FUDeyROHu6QtIPJCh0Q&#43;Qp74TmqxrcuZJEuFsT&#43;fWCg="></script>

<script defer src="/lxd-compose-docs/sw.min.0232c72a126fed7e0676141811678c3a5a10a4fd735ed4b603233bbcb7f842a7.js" integrity="sha256-AjLHKhJv7X4GdhQYEWeMOloQpP1zXtS2AyM7vLf4Qqc="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head><section class="top-bar animated-header">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<nav class="navbar navbar-expand-lg navbar-light bg-light">
					<a class="navbar-brand" href="https://mottainaici.github.io/lxd-compose-docs/">
						<img src="https://mottainaici.github.io/lxd-compose-docs/images/logo.png" alt="LXD Compose">
					</a>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
						aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="navigation">
						<ul class="navbar-nav ml-auto">
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://mottainaici.github.io/lxd-compose-docs/">Home</a>
							</li>
							
							
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://mottainaici.github.io/lxd-compose-docs/docs">Documentation</a>
							</li>
							
							
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://github.com/MottainaiCI/lxd-compose/issues">Contact</a>
							</li>
							
							
						</ul>
					</div>
				</nav>
			</div>
		</div>
	</div>
</section><body dir="ltr">

  <div style="margin-top: 60px;">

  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li>
  <a href="/lxd-compose-docs/docs/"><strong>The Project</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/getting-started/"><strong>Getting Started</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/"><strong>Concepts</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/">Environments</a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#profiles">Profiles</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#networks">Networks</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#acls">ACLs</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#commands">Commands</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#storages">Storages</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/project/">Projects</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/group/">Groups</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/node/">Nodes</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/variable/">Variables</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/hook/">Hooks</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/"><strong>Template Engine</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/#jinja2-engine">Jinja2 Engine</a></li>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/#mottainai-engine">Mottainai Engine</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/render_engine/"><strong>Render Engine</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/packaging/"><strong>Packaging Projects</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/"class=active><strong>Tutorial</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#setup-lxd-environment">Step1: Install LXD</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-2-configure-lxd-client">Step2: Configure LXD Client</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-3-configure-lxd-compose-configuration-file">Step3: Configure LXD Compose configuration file</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-4-configure-lxd-profiles-and-networks">Step4: Configure LXD profiles and networks</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-5-create-your-first-project">Step5: Create your first project</a>
<br /></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/vmware/"><strong>LXD Compose &amp; VMWare</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/vmware-1-1/">VmWare-LXD 1:1</a></li>
<li>
  <a href="/lxd-compose-docs/docs/vmware-1-n-forward/">VmWare-LXD 1:N</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/galaxy/"><strong>LXD Compose Galaxy</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/galaxy/"><strong>Deploy Services on Raspberry Pi</strong></a></li>
</ul>
<p><br /></p>






  
<ul>
  
  <li>
    <a href="https://github.com/MottainaiCI/lxd-compose" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://join.slack.com/t/mottainaici/shared_invite/zt-zdmrc651-IvxE9j~TT5ssv_CVo51uZg" target="_blank" rel="noopener">
        Official Slack Channel
      </a>
  </li>
  
  <li>
    <a href="https://github.com/sponsors/geaaru" target="_blank" rel="noopener">
        Support our work!
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page" >
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/lxd-compose-docs/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Tutorial</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="tutorial">
  Tutorial
  <a class="anchor" href="#tutorial">#</a>
</h1>
<p>Hereinafter, how to create your first project in five steps. Enjoy!</p>
<h2 id="setup-lxd-environment">
  Setup LXD Environment
  <a class="anchor" href="#setup-lxd-environment">#</a>
</h2>
<h3 id="step-1-install-lxd">
  Step 1: Install LXD
  <a class="anchor" href="#step-1-install-lxd">#</a>
</h3>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-uniqueid" id="tabs-uniqueid-0" checked="checked" />
  <label for="tabs-uniqueid-0">Ubuntu Linux</label>
  <div class="book-tabs-content markdown-inner"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; apt-get install lxd-installer
$&gt; apt-get install zfsutils-linux
$&gt; apt-get install curl
</code></pre></div><p>In Ubuntu LXD is not available as a single package, but it uses <em>snapd</em>,
so <code>lxd-installer</code> is the installer package of LXD.
The installation of zfsutils is not mandatory but it prepares the
environment if you want to use ZFS with LXD.</p>
<p>Ubuntu supplies LXD through <code>snapd</code> service. There isn&rsquo;t a real package.</p>
</div><input type="radio" class="toggle" name="tabs-uniqueid" id="tabs-uniqueid-1"  />
  <label for="tabs-uniqueid-1">Macaroni OS</label>
  <div class="book-tabs-content markdown-inner"><p>This is for <em>Macaroni Funtoo</em> release:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; luet install -y app-emulation/lxd
</code></pre></div><p>If you follow the steps described in the <code>step 1b</code> lxd-compose manages the installation itself.</p>
</div><input type="radio" class="toggle" name="tabs-uniqueid" id="tabs-uniqueid-2"  />
  <label for="tabs-uniqueid-2">Funtoo Linux</label>
  <div class="book-tabs-content markdown-inner"><p>Install and compile LXD with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; emerge app-emulation/lxd
</code></pre></div><p>The Funtoo documentaion is available <a href="https://www.funtoo.org/LXD">here</a>.</p>
<p>If you follow the steps described in the <code>step 1b</code> lxd-compose manages the installation itself.</p>
</div></div>

<p>Follow the 
  <a href="/lxd-compose-docs/docs/getting-started/#installation">installation</a> steps
to install <code>lxd-compose</code> binary.</p>
<p>Enable LXD API in binding (this is not needed if you want to use <code>local</code>
remote through unix socket):</p>
<h4 id="step-1a-setup-lxd-instance-manually">
  Step 1a: Setup LXD instance manually
  <a class="anchor" href="#step-1a-setup-lxd-instance-manually">#</a>
</h4>
<p>Some initial steps could be done manually for a simple installation.
So, just after that the service is running proceed with the configuration
of the API port binding and password with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxc config set core.https_address <span style="color:#f92672">[</span>::<span style="color:#f92672">]</span>:8443
$&gt; lxc config set core.trust_password mypassword
</code></pre></div><p>If it&rsquo;s used LXD only with unix socket the previous commands are not needed.</p>
<p>To create containers and download image it&rsquo;s needed create the default storage:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxc storage create default btrfs size<span style="color:#f92672">=</span>20GB
</code></pre></div><p>In the example it used BTRFS loopback mode but there are different options.</p>
<blockquote class="book-hint info">
  If you setup LXD instance with <code>lxd init --preseed</code> you can setup
some configurations directly with a YAML source.
</blockquote>

<h4 id="step-1b-setup-lxd-instance-through-lxd-compose">
  Step 1b: Setup LXD instance through lxd-compose
  <a class="anchor" href="#step-1b-setup-lxd-instance-through-lxd-compose">#</a>
</h4>
<p>On both 
  <a href="httsp://www.macaroni.funtoo.org">Macaroni OS</a> and 
  <a href="https://www.funtoo.org/">Funtoo</a> it is possible to use <code>lxd-compose</code> to setup LXD instance directly with the
project <code>lxd-setup-and-test</code> from

  <a href="https://github.com/MottainaiCI/lxd-compose-galaxy/">LXD Compose Galaxy Project</a>.</p>
<p>New OS will be integrated in the future.</p>
<p>Hereinafter, the steps to follow.</p>
<ol>
<li>
<p>Install <code>lxd-compose</code>, <code>jq</code> and <code>yq</code> tools. Follow these commands or just install from
your Linux distro the same tools:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">
 $&gt; sudo su
 $&gt; curl https://raw.githubusercontent.com/geaaru/luet/geaaru/contrib/config/get_luet_root.sh | sh <span style="color:#75715e"># Install luet on your system</span>
 $&gt; luet install -y app-emulation/lxd-compose utils/jq utils/yq <span style="color:#75715e"># Install lxd-compose binary</span>
</code></pre></div></li>
<li>
<p>Get the LXD Compose Galaxy project</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> $&gt; git clone https://github.com/MottainaiCI/lxd-compose-galaxy.git
 $&gt; cd lxd-compose-galaxy
</code></pre></div></li>
<li>
<p>Choice the storage type between the available visible with this command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">
 $&gt; lxd-compose storage list lxd-setup-and-test
 |    STORAGES    | DRIVER |                         DOCUMENTATION                         |
 |----------------|--------|---------------------------------------------------------------|
 | dir-source     | dir    | Directory Storage Pool using existing path /lxd.              |
 |                |        |                                                               |
 |                |        | Using --render-env <span style="color:#e6db74">&#34;storage_source=/mydir&#34;</span> to                 |
 |                |        | override existing /lxd path.                                  |
 |                |        |                                                               |
 | btrfs-source   | btrfs  | BTRFS Storage Pool using existing path or device.             |
 |                |        |                                                               |
 |                |        | Using --render-env <span style="color:#e6db74">&#34;storage_source=/dev/sdX&#34;</span> to override      |
 |                |        | default /lxd path.                                            |
 |                |        |                                                               |
 | btrfs-loopback | btrfs  | BTRFS Storage Pool Loop disk.                                 |
 |                |        |                                                               |
 |                |        | Use --render-env <span style="color:#e6db74">&#34;storage_size=200GB&#34;</span> to override             |
 |                |        | default 150GB size.                                           |
 |                |        |                                                               |
 |                |        | Use --render-env <span style="color:#e6db74">&#34;storage_mount_options=compress=zstd:3&#34;</span>      |
 |                |        | to enable additional btrfs mount options <span style="color:#66d9ef">for</span> compression      |
 |                |        | or other.                                                     |
 |                |        |                                                               |
 |                |        | Other compressions options:                                   |
 |                |        |                                                               |
 |                |        | storage_mount_options<span style="color:#f92672">=</span>rw,relatime,space_cache,compress<span style="color:#f92672">=</span>zstd:3 |
 |                |        |                                                               |
 | zfs-source     | zfs    | ZFS Storage pool using existing ZFS Pool or dataset           |
 |                |        | or create a new ZFS Zpool on the specified device.            |
 |                |        |                                                               |
 | zfs-loopback   | zfs    | ZFS Loopback Storage pool.                                    |
 |                |        |                                                               |
 |                |        | Use --render-env <span style="color:#e6db74">&#34;zfs_pool_name=pool&#34;</span> to override             |
 |                |        | default ZFS pool name lxd-compose-pool.                       |
 |                |        |                                                               |
 |                |        | Use --render-env <span style="color:#e6db74">&#34;storage_size=XGB&#34;</span> to override               |
 |                |        | default storage size of 100GB                                 |
 |                |        |                                                               |
 | lvm-source     | lvm    | LVM Storage Pool using existing path or device.               |
 |                |        |                                                               |
 |                |        | Using --render-env <span style="color:#e6db74">&#34;storage_source=/dev/sdx&#34;</span> to               |
 |                |        | override existing <span style="color:#e6db74">`</span>lvm<span style="color:#e6db74">`</span> volume group.                         |
 |                |        |                                                               |
 | lvm-loopback   | lvm    | LVM Loopback Storage pool.                                    |
 |                |        |                                                               |
 | ceph-source    | ceph   | Ceph Storage pool.                                            |
 |                |        |                                                               |
 |                |        | NOTE: Not tested.                                             |
 |                |        |                                                               |
</code></pre></div><p>The description of the storage could not be describe all possibilies render options.
After the identification of the storage type it&rsquo;s better check the storage specification
to see all possible options directly on 
  <a href="https://github.com/MottainaiCI/lxd-compose-galaxy/tree/master/envs/common/storages">repository</a>.</p>
</li>
<li>
<p>When the storage is selected it&rsquo;s needed create the render values file with the storage options.
In the example the storage selected is <code>btrfs-loopback</code> with a size of 30GB and with compres:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">
 $&gt; echo <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74"> storage_mount_options: compress=zstd:3
</span><span style="color:#e6db74"> storage_size: 30GB
</span><span style="color:#e6db74"> storage_name: btrfs-loopback
</span><span style="color:#e6db74"> storage_render_values: render/values.yaml
</span><span style="color:#e6db74"> &#34;</span> &gt; render/values.yaml
</code></pre></div><p>The last row is needed because the lxd-compose specs executes the <code>lxd-compose storage create</code>
command after the setup of LXD instance.</p>
</li>
<li>
<p>Define the configuration file of your LXD instance with the editing of the file <code>envs/lxd-setup/vars/common.yaml</code>.</p>
<p>Between the configuration options it&rsquo;s possible define what are the users and the subuid/subgid to
use for the management of the unprivileged containers and that will be configured by the execution:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"> <span style="color:#75715e"># Define the subuid/subguid to create</span>
 <span style="color:#f92672">lxc_subuids</span>:
   - <span style="color:#f92672">user</span>: <span style="color:#ae81ff">root</span>
     <span style="color:#f92672">home</span>: <span style="color:#ae81ff">/root</span>
     <span style="color:#f92672">map</span>: <span style="color:#ae81ff">1000000-1065535</span>

 <span style="color:#f92672">lxc_subgids</span>:
   - <span style="color:#f92672">user</span>: <span style="color:#ae81ff">root</span>
     <span style="color:#f92672">home</span>: <span style="color:#ae81ff">/root</span>
     <span style="color:#f92672">map</span>: <span style="color:#ae81ff">1000000-1065535</span>
</code></pre></div><p>And then the LXD instance configuration:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"> <span style="color:#75715e"># LXD Instance configuration</span>
 <span style="color:#f92672">lxd_config</span>:
   <span style="color:#f92672">config</span>:
     <span style="color:#75715e"># Configure the LXD password</span>
     <span style="color:#f92672">core.trust_password</span>: <span style="color:#ae81ff">mysecret</span>
     <span style="color:#75715e"># It seems that for cluster it&#39;s better define the</span>
     <span style="color:#75715e"># server interface used.</span>
     <span style="color:#f92672">core.https_address</span>: <span style="color:#e6db74">&#34;[::]:8443&#34;</span>

     <span style="color:#75715e"># Configure HTTPS proxy to use</span>
     <span style="color:#75715e"># core.proxy_https: &#34;http://192.168.10.1:8080&#34;</span>
     <span style="color:#75715e"># Configure HTTP proxy to use</span>
     <span style="color:#75715e"># core.proxy_http: &#34;http://192.168.10.1:8080&#34;</span>
     <span style="color:#75715e"># Configure Proxy Ignore hosts</span>
     <span style="color:#75715e"># core.proxy_ignore_hosts</span>

     <span style="color:#75715e"># See https://linuxcontainers.org/lxd/docs/master/server/</span>
     <span style="color:#75715e"># for all available options.</span>

     <span style="color:#75715e"># Number of days after which an unused cached remote</span>
     <span style="color:#75715e"># image will be flushed</span>
     <span style="color:#f92672">images.remote_cache_expiry</span>: <span style="color:#ae81ff">5</span>

     <span style="color:#75715e"># Whether to automatically update any image that</span>
     <span style="color:#75715e"># LXD caches</span>
     <span style="color:#75715e"># images.auto_update_cached: true</span>

     <span style="color:#75715e"># Interval in hours at which</span>
     <span style="color:#75715e"># to look for update to cached images</span>
     <span style="color:#75715e"># (0 disables it)</span>
     <span style="color:#75715e"># images.auto_update_interval: 1</span>
</code></pre></div><p>The selected storage will be configured in the <code>default</code> profile of the LXD instance configured.</p>
</li>
<li>
<p>Now it&rsquo;s time to configure your LXD server and to run <code>lxd-compose</code> in the host where you
want to do the setup (so use <code>scp</code> if it isn&rsquo;t your node or another tool).</p>
<p>So, just run this in <code>Macaroni</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> $&gt; lxd-compose a lxd-setup-and-test --render-env <span style="color:#e6db74">&#34;os=macaroni&#34;</span> --render-values render/values.yaml
</code></pre></div><p>or this in <code>Funtoo</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> $&gt; lxd-compose a lxd-setup-and-test --render-env <span style="color:#e6db74">&#34;os=funtoo&#34;</span> --render-values render/values.yaml
</code></pre></div><p>Based on the selected OS the <code>lxd-compose</code> will install the packages (with the right PMS) and
then will configure the LXD instance, it will create the LXD profiles and then it will test the setup.</p>
</li>
</ol>
<blockquote class="book-hint info">
  You can always setup more of one storage too just using directly the <code>lxd-compose storage create</code>
command.
</blockquote>

<h3 id="step-2-configure-lxd-client">
  Step 2: Configure LXD client
  <a class="anchor" href="#step-2-configure-lxd-client">#</a>
</h3>
<p><code>lxd-compose</code> uses the LXD&rsquo;s client engine to call LXD API. This means
that you need configure your environment with a <code>config.yml</code> that
works with <code>lxc</code> too.</p>
<p>In general, the <code>lxc</code> client follows this steps on found the configuration
files with the remotes and certificates to use:</p>
<ul>
<li>
<p>if it sets <code>LXD_CONF</code> variable env that it uses the path defined
in the variable to search the <code>config.yml</code> and to read the
certificates</p>
</li>
<li>
<p>if <code>LXD_CONF</code> variable is not set or the file <code>$LXD_CONF/config.yml</code>
doesn&rsquo;t exist it search under <code>$HOME/.config/lxc</code>.</p>
</li>
<li>
<p>if <code>$HOME/.config/lxc</code> doesn&rsquo;t exist it creates the directory and
the file <code>$HOME/.config/lxc/config.yml</code> with the default remotes.</p>
</li>
</ul>
<p>In additional, there are some extra variables available that are described

  <a href="https://lxd.readthedocs.io/en/latest/environment/">here</a>.</p>
<p>By default <code>lxc</code> uses the default remote <code>local</code> through LXD unix socket:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">default-remote</span>: <span style="color:#ae81ff">local</span>
<span style="color:#f92672">remotes</span>:
  <span style="color:#f92672">images</span>:
    <span style="color:#f92672">addr</span>: <span style="color:#ae81ff">https://images.linuxcontainers.org</span>
    <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">simplestreams</span>
    <span style="color:#f92672">public</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#f92672">local</span>:
    <span style="color:#f92672">addr</span>: <span style="color:#ae81ff">unix://</span>
    <span style="color:#f92672">public</span>: <span style="color:#66d9ef">false</span>
</code></pre></div><blockquote class="book-hint warning">
  It&rsquo;s not possible to remove the <code>local</code> remote, it&rsquo;s automatically added by LXD engine. To disable it (normally for the P2P Mode) you need set the field <code>lxd_local_disable</code> at <em>true</em> in the <em>general</em> section of <code>lxd-compose</code> config.
</blockquote>

<p>I think that a best practices to follow with <code>lxd-compose</code> (if it isn&rsquo;t used the
<em>$HOME</em> configuration file) is to create an <code>lxd-conf</code> directory where to register
the needed remotes of the <code>lxd-compose</code> projects and the certificates.</p>
<p>Hereinafter, an example of the <em>tree</em> created with these steps:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; <span style="color:#75715e"># Create your projects directory</span>
$&gt; mkdir -p $HOME/lxd-compose-projects/my-first-project
$&gt; cd $HOME/lxd-compose-projects/my-first-project

$&gt; <span style="color:#75715e"># Create lxd-conf directory to use project LXD configuration.</span>
$&gt; mkdir lxd-conf

$&gt; <span style="color:#75715e"># Force `lxc` client to use project directory</span>
$&gt; <span style="color:#75715e"># NOTE: Setting LXD_CONF variable is needed only for lxc client,</span>
$&gt; <span style="color:#75715e">#       lxd-compose permits to avoid this with the specific option</span>
$&gt; <span style="color:#75715e">#       descibed below.</span>
$&gt; export LXD_CONF<span style="color:#f92672">=</span>./lxd-conf

$&gt; <span style="color:#75715e"># Add remote related to the instance to use for my projects.</span>
$&gt; <span style="color:#75715e"># In this case we use the same node to use lxd-compose and LXD instance.</span>
$&gt; lxc remote add mylxd-instance https://127.0.0.1:8443 --accept-certificate
To start your first instance, try: lxc launch ubuntu:18.04

Generating a client certificate. This may take a minute...
Admin password <span style="color:#66d9ef">for</span> mylxd-instance:

$&gt; find lxd-conf/
lxd-conf/
lxd-conf/client.key
lxd-conf/servercerts
lxd-conf/servercerts/mylxd-instance.crt
lxd-conf/config.yml
lxd-conf/client.crt
</code></pre></div><p>In the example, the <em>remote</em> is an external host, if you want to use
directly the <em>local</em> remote you just need to run <code>lxc</code> one time to create the
right tree. Instead, if you want to use the LXD HTTP API locally you need
to add the remote related to <code>127.0.0.1</code> address.</p>
<p>When <code>lxc</code> client is been configured you are ready to setup <code>lxd-compose</code> config
of the project. You can test it with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxc list mylxd-instance:
</code></pre></div><p>If it works, compliments the step 1 is completed!</p>
<h4 id="lxd-installed-from-snapd">
  LXD installed from snapd
  <a class="anchor" href="#lxd-installed-from-snapd">#</a>
</h4>
<p>LXD available through snapd doesn&rsquo;t expose local unix socket under default path
<code>/var/lib/lxd/unix.socket</code> but normally under the path <code>/var/snap/lxd/common/lxd/unix.socket</code>.</p>
<p>This means that to use <code>local</code> connection it&rsquo;s better to create under the config.yaml an entry like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  <span style="color:#f92672">local-snapd</span>:
    <span style="color:#f92672">addr</span>: <span style="color:#ae81ff">unix:///var/snap/lxd/common/lxd/unix.socket</span>
    <span style="color:#f92672">public</span>: <span style="color:#66d9ef">false</span>
</code></pre></div><p>and then to use <code>local-snapd</code> in <code>connection</code> option.</p>
<blockquote class="book-hint warning">
  With LXD &gt;=5.0 that contains new features to create multiple file socket with different permissions
this configuration doesn&rsquo;t work correctly. I will update the documentation correctly soon.
</blockquote>

<blockquote class="book-hint warning">
  At the moment on Ubuntu the <code>lxc</code> command is supplied through snapd and it seems that
that wrapper doesn&rsquo;t propagate the environments variables to real binary. This means that
override <code>LXD_CONF</code>  doesn&rsquo;t work. The LXD remotes must be modified only in the snapd path.
Personally, I prefer to use OS where <code>lxc</code> is supplied as binary directly.
</blockquote>

<p>Instead, if it&rsquo;s used the HTTPS API this is not needed.</p>
<h3 id="step-3-configure-lxd-compose-configuration-file">
  Step 3: Configure LXD Compose configuration file
  <a class="anchor" href="#step-3-configure-lxd-compose-configuration-file">#</a>
</h3>
<p>By default <code>lxd-compose</code> search for the file <code>$PWD/.lxd-compose.yml</code> else
it is possible to pass the configuration file path with the <code>-c|--config</code>
option.</p>
<p>In this case we override the LXD configuration path so what we need to do
is to create a configuration file like this where we set also the path
where <code>lxd-compose</code> search for the environment files.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; echo <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">general:
</span><span style="color:#e6db74">  debug: false
</span><span style="color:#e6db74">  lxd_confdir: ./lxd-conf
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">logging:
</span><span style="color:#e6db74">  level: &#34;</span>info<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Define the directories list where lxd-compose search
</span><span style="color:#e6db74"># for environments files with .yml or .yaml extension.
</span><span style="color:#e6db74">env_dirs:
</span><span style="color:#e6db74">- ./envs&#34;</span> &gt; .lxd-compose.yml
</code></pre></div><h3 id="step-4-configure-lxd-profiles-and-networks">
  Step 4: Configure LXD profiles and networks
  <a class="anchor" href="#step-4-configure-lxd-profiles-and-networks">#</a>
</h3>
<p>This step is needed only if you want to define custom profiles to use
with your containers and a particolar network configuration.</p>
<p>If your profiles are been defined like your network configuration you can
skip this step.</p>
<p>If you have used the <code>step 1b</code> a lot of profiles and a network is already
available and configured.</p>
<blockquote class="book-hint info">
  Under the LXD Compose Galaxy project, you can find a lot of examples with
ready to use profiles that you can add to your project easily.
</blockquote>

<p>The next step is to create the project environment file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; mkdir envs/
$&gt; echo <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">version: \&#34;1\&#34;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74"># Using mottainai template engine
</span><span style="color:#e6db74">template_engine:
</span><span style="color:#e6db74">  engine: \&#34;mottainai\&#34;
</span><span style="color:#e6db74">&#34;</span> &gt; envs/env1.yml
</code></pre></div><h4 id="prepare-your-profiles">
  Prepare your profiles
  <a class="anchor" href="#prepare-your-profiles">#</a>
</h4>
<p>Now we can define our profiles inside the file <code>envs/env1.yml</code> after the content
created above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">profiles</span>:
- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;privileged&#34;</span>
  <span style="color:#f92672">config</span>:
    <span style="color:#f92672">security.privileged</span>: <span style="color:#e6db74">&#34;true&#34;</span>
  <span style="color:#f92672">description</span>: <span style="color:#ae81ff">Privileged profile</span>
  <span style="color:#f92672">devices</span>:
    <span style="color:#f92672">fuse</span>:
      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/dev/fuse</span>
      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">unix-char</span>
    <span style="color:#f92672">tuntap</span>:
      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/dev/net/tun</span>
      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">unix-char</span>
    <span style="color:#75715e"># Comment this if zfs is not available.</span>
    <span style="color:#f92672">zfs</span>:
      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/dev/zfs</span>
      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">unix-char</span>

- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;net-mottainai0&#34;</span>
  <span style="color:#f92672">description</span>: <span style="color:#ae81ff">Net mottainai0</span>
  <span style="color:#f92672">devices</span>:
    <span style="color:#f92672">eth0</span>:
      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">eth0</span>
      <span style="color:#f92672">nictype</span>: <span style="color:#ae81ff">bridged</span>
      <span style="color:#f92672">parent</span>: <span style="color:#ae81ff">mottainai0</span>
      <span style="color:#f92672">type</span>: <span style="color:#ae81ff">nic</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">default</span>
  <span style="color:#f92672">description</span>: <span style="color:#ae81ff">Default Storage</span>
  <span style="color:#f92672">root</span>:
    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
    <span style="color:#f92672">pool</span>: <span style="color:#ae81ff">default</span>
    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">disk</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flavor-medium</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;flavor with 2GB RAM&#34;</span>
  <span style="color:#f92672">config</span>:
    <span style="color:#f92672">limits.memory</span>: <span style="color:#ae81ff">2GB</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flavor-big</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;flavor with 3GB RAM&#34;</span>
  <span style="color:#f92672">config</span>:
    <span style="color:#f92672">limits.memory</span>: <span style="color:#ae81ff">3GB</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">flavor-thin</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;flavor with 500MB RAM&#34;</span>
  <span style="color:#f92672">config</span>:
    <span style="color:#f92672">limits.memory</span>: <span style="color:#ae81ff">500MB</span>
</code></pre></div><p>To configure profiles in the LXD instance you need define at least one project
and one group. We need to add in the file <code>envs/env1.yml</code> this section:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">projects</span>:
- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;my-first-project&#34;</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;This is my fist project.&#34;</span>

  <span style="color:#f92672">groups</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;my-first-group&#34;</span>
      <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;My first group&#34;</span>

      <span style="color:#75715e"># Set the remote to use for the group.</span>
      <span style="color:#75715e"># In this case we use the remote mylxd-instance</span>
      <span style="color:#75715e"># created in the previous steps.</span>
      <span style="color:#f92672">connection</span>: <span style="color:#e6db74">&#34;mylxd-instance&#34;</span>

      <span style="color:#75715e"># We use the ephemeral container for this tutorial.</span>
      <span style="color:#f92672">ephemeral</span>: <span style="color:#66d9ef">true</span>
</code></pre></div><p>Now we are ready to initialize the LXD instance with our profiles:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$&gt; lxd-compose profile create my-first-project -a
Profile privileged created correctly.
Profile net-mottainai0 created correctly.
Profile default already created correctly.
Profile flavor-medium created correctly.
Profile flavor-big created correctly.
Profile flavor-thin created correcly.

$&gt; <span style="color:#75715e"># Update existing profiles</span>
$&gt; lxd-compose profile create my-first-project -a -u
</code></pre></div><h4 id="prepare-your-networks">
  Prepare your networks
  <a class="anchor" href="#prepare-your-networks">#</a>
</h4>
<p>Also the network devices used by LXD could be configured from <code>lxd-compose</code>
and prepare the network with the right options used by the project.</p>
<p>In the file <code>envs/env1.yml</code> under the <code>profiles</code> section add the <code>networks</code>
section:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">networks</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;mottainai0&#34;</span>
    <span style="color:#f92672">type</span>: <span style="color:#e6db74">&#34;bridge&#34;</span>
    <span style="color:#f92672">config</span>:
      <span style="color:#f92672">bridge.driver</span>: <span style="color:#ae81ff">native</span>
      <span style="color:#f92672">dns.domain</span>: <span style="color:#ae81ff">mottainai.local</span>
      <span style="color:#f92672">dns.mode</span>: <span style="color:#ae81ff">managed</span>
      <span style="color:#f92672">ipv4.address</span>: <span style="color:#ae81ff">172.18.10.1</span><span style="color:#ae81ff">/23</span>
      <span style="color:#f92672">ipv4.dhcp</span>: <span style="color:#e6db74">&#34;true&#34;</span>
      <span style="color:#f92672">ipv4.firewall</span>: <span style="color:#e6db74">&#34;true&#34;</span>
      <span style="color:#f92672">ipv4.nat</span>: <span style="color:#e6db74">&#34;true&#34;</span>
      <span style="color:#f92672">ipv6.nat</span>: <span style="color:#e6db74">&#34;false&#34;</span>
      <span style="color:#f92672">ipv6.dhcp</span>: <span style="color:#e6db74">&#34;false&#34;</span>
</code></pre></div><p>Then we create the network:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ lxd-compose network create my-first-project -a
Network mottainai0 created.

<span style="color:#75715e"># To update configuration existing networks</span>
$ lxd-compose network create my-first-project -a -u
</code></pre></div><p>You can check the result with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ lxc network list
+-----------------+----------+---------+----------------+---------------------------+-------------------------------------------+---------+
|      NAME       |   TYPE   | MANAGED |      IPV4      |           IPV6            |                DESCRIPTION                | USED BY |
+-----------------+----------+---------+----------------+---------------------------+-------------------------------------------+---------+
| eth0            | physical | NO      |                |                           |                                           | <span style="color:#ae81ff">0</span>       |
+-----------------+----------+---------+----------------+---------------------------+-------------------------------------------+---------+
| eth1            | physical | NO      |                |                           |                                           | <span style="color:#ae81ff">0</span>       |
+-----------------+----------+---------+----------------+---------------------------+-------------------------------------------+---------+
| mottainai0      | bridge   | YES     | 172.18.10.1/23 | fd42:30e5:6279:93f::1/64  | Network mottainai0 created by lxd-compose | <span style="color:#ae81ff">0</span>       |
+-----------------+----------+---------+----------------+---------------------------+-------------------------------------------+---------+

</code></pre></div><p>There are a lot of options for setup network devices described in the

  <a href="https://lxd.readthedocs.io/en/latest/networks/">LXD Project</a>.</p>
<h3 id="step-5-create-your-first-project">
  Step 5: Create your first project
  <a class="anchor" href="#step-5-create-your-first-project">#</a>
</h3>
<p>We are ready to prepare our first deploy with <code>lxd-compose</code>.
In this tutorial, we use single file specs for simplicity.
My suggestion is to use the <code>include_env_files</code> and
<code>include_groups_files</code> when there are verbose specs.</p>
<p>We need open the file <code>envs/env1.yml</code> again and to complete our group specs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;my-first-project&#34;</span>
  <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;This is my fist project.&#34;</span>

  <span style="color:#75715e"># We use online variable</span>
  <span style="color:#f92672">vars</span>:
    - <span style="color:#f92672">envs</span>:
        <span style="color:#f92672">yq_version</span>: <span style="color:#e6db74">&#34;3.4.1&#34;</span>
        <span style="color:#f92672">ntpd_config</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">          # Pools for Gentoo users
</span><span style="color:#e6db74">          server 0.gentoo.pool.ntp.org
</span><span style="color:#e6db74">          server 1.gentoo.pool.ntp.org
</span><span style="color:#e6db74">          server 2.gentoo.pool.ntp.org
</span><span style="color:#e6db74">          server 3.gentoo.pool.ntp.org
</span><span style="color:#e6db74">          restrict default nomodify nopeer noquery limited kod
</span><span style="color:#e6db74">          restrict 127.0.0.1
</span><span style="color:#e6db74">          restrict [::1]</span>          

  <span style="color:#75715e"># In this case we have only one group and only</span>
  <span style="color:#75715e"># one project. Setting hooks here means that</span>
  <span style="color:#75715e"># are executed by all groups and nodes</span>
  <span style="color:#f92672">hooks</span>:
    - <span style="color:#f92672">event</span>: <span style="color:#e6db74">&#34;post-node-creation&#34;</span>
      <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">apt-get update</span>
        - <span style="color:#ae81ff">apt-get upgrade -y</span>
        - <span style="color:#ae81ff">apt-get install -y htop vim jq ntp wget</span>

    - <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
      <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">sleep 2</span>
        - <span style="color:#ae81ff">wget -q -O /usr/bin/yq https://github.com/mikefarah/yq/releases/download/${yq_version}/yq_linux_amd64</span>
        - <span style="color:#ae81ff">chmod a+x /usr/bin/yq</span>

  <span style="color:#f92672">groups</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;my-first-group&#34;</span>
      <span style="color:#f92672">description</span>: <span style="color:#e6db74">&#34;My first group&#34;</span>

      <span style="color:#75715e"># Set the remote to use for the group.</span>
      <span style="color:#75715e"># In this case we use the remote mylxd-instance</span>
      <span style="color:#75715e"># created in the previous steps.</span>
      <span style="color:#f92672">connection</span>: <span style="color:#e6db74">&#34;mylxd-instance&#34;</span>

      <span style="color:#75715e"># We use the ephemeral container for this tutorial.</span>
      <span style="color:#f92672">ephemeral</span>: <span style="color:#66d9ef">true</span>

      <span style="color:#f92672">common_profiles</span>:
        - <span style="color:#ae81ff">net-mottainai0</span>
        - <span style="color:#ae81ff">sdpool</span>

      <span style="color:#f92672">nodes</span>:
        - <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;node1&#34;</span>
          <span style="color:#f92672">image_source</span>: <span style="color:#e6db74">&#34;ubuntu/20.10&#34;</span>
          <span style="color:#f92672">image_remote_server</span>: <span style="color:#e6db74">&#34;images&#34;</span>

          <span style="color:#f92672">entrypoint</span>:
            - <span style="color:#e6db74">&#34;/bin/bash&#34;</span>
            - <span style="color:#e6db74">&#34;-c&#34;</span>

          <span style="color:#f92672">hooks</span>:
            - <span style="color:#f92672">event</span>: <span style="color:#e6db74">&#34;post-node-sync&#34;</span>
              <span style="color:#f92672">flags</span>:
                - <span style="color:#ae81ff">upgrade</span>
              <span style="color:#f92672">commands</span>:
                - <span style="color:#ae81ff">apt-get update &amp;&amp; apt-get upgrade -y</span>

            - <span style="color:#f92672">event</span>: <span style="color:#e6db74">&#34;post-node-sync&#34;</span>
              <span style="color:#f92672">flags</span>:
                - <span style="color:#ae81ff">update_ntpd_config</span>
              <span style="color:#f92672">commands</span>:
                - |<span style="color:#e6db74">
</span><span style="color:#e6db74">                  </span>                  <span style="color:#ae81ff">echo &#34;${ntpd_config}&#34; &gt; /etc/ntp.conf</span>
                - <span style="color:#ae81ff">cat /etc/ntp.conf</span>
                - <span style="color:#ae81ff">systemctl restart ntp</span>

</code></pre></div><p>Deploy your NTP Service project:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># Create the container</span>
$&gt; lxd-compose apply my-first-project
Apply project my-first-project
Searching image: ubuntu/20.10
For image ubuntu/20.10 found fingerprint 4aeac41e7f72b587409493fb814522fcf0925ba9c0c7250ab15fb36867c43d85
&gt;&gt;&gt; Creating container node1... -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>started<span style="color:#f92672">]</span>  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - apt-get update -  
Hit:1 http://archive.ubuntu.com/ubuntu groovy InRelease
Get:2 http://security.ubuntu.com/ubuntu groovy-security InRelease <span style="color:#f92672">[</span><span style="color:#ae81ff">110</span> kB<span style="color:#f92672">]</span>
Get:3 http://archive.ubuntu.com/ubuntu groovy-updates InRelease <span style="color:#f92672">[</span><span style="color:#ae81ff">115</span> kB<span style="color:#f92672">]</span>
Get:4 http://security.ubuntu.com/ubuntu groovy-security/main amd64 Packages <span style="color:#f92672">[</span><span style="color:#ae81ff">221</span> kB<span style="color:#f92672">]</span>
Get:5 http://security.ubuntu.com/ubuntu groovy-security/universe amd64 Packages <span style="color:#f92672">[</span>57.6 kB<span style="color:#f92672">]</span>
Get:6 http://archive.ubuntu.com/ubuntu groovy-updates/main amd64 Packages <span style="color:#f92672">[</span><span style="color:#ae81ff">366</span> kB<span style="color:#f92672">]</span>
Get:7 http://archive.ubuntu.com/ubuntu groovy-updates/main Translation-en <span style="color:#f92672">[</span>94.1 kB<span style="color:#f92672">]</span>
Get:8 http://archive.ubuntu.com/ubuntu groovy-updates/universe amd64 Packages <span style="color:#f92672">[</span><span style="color:#ae81ff">138</span> kB<span style="color:#f92672">]</span>
Get:9 http://archive.ubuntu.com/ubuntu groovy-updates/universe Translation-en <span style="color:#f92672">[</span>53.2 kB<span style="color:#f92672">]</span>
Fetched <span style="color:#ae81ff">1156</span> kB in 1s <span style="color:#f92672">(</span><span style="color:#ae81ff">1515</span> kB/s<span style="color:#f92672">)</span>
Reading package lists...
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - apt-get upgrade -y -  
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
<span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">0</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">0</span> not upgraded.
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - apt-get install -y htop vim jq ntp wget -  
Reading package lists...
Building dependency tree...
Reading state information...
...
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - sleep <span style="color:#ae81ff">2</span> -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - wget -q -O /usr/bin/yq https://github.com/mikefarah/yq/releases/download/<span style="color:#e6db74">${</span>yq_version<span style="color:#e6db74">}</span>/yq_linux_amd64 -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - chmod a+x /usr/bin/yq -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get upgrade -y -  
Hit:1 http://security.ubuntu.com/ubuntu groovy-security InRelease
Hit:2 http://archive.ubuntu.com/ubuntu groovy InRelease
Hit:3 http://archive.ubuntu.com/ubuntu groovy-updates InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
<span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">0</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">0</span> not upgraded.
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ntpd_config<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> &gt; /etc/ntp.conf
 -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - cat /etc/ntp.conf -  
<span style="color:#75715e"># Pools for Gentoo users</span>
server 0.gentoo.pool.ntp.org
server 1.gentoo.pool.ntp.org
server 2.gentoo.pool.ntp.org
server 3.gentoo.pool.ntp.org
restrict default nomodify nopeer noquery limited kod
restrict 127.0.0.1
restrict <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>

&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - systemctl restart ntp -  
All <span style="color:#66d9ef">done</span>.
</code></pre></div><p>If the node1 is already present <code>lxd-compose</code> skips <em>post-node-creation</em> hooks:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxd-compose apply my-first-project 
Apply project my-first-project
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get upgrade -y -  
Hit:1 http://archive.ubuntu.com/ubuntu groovy InRelease
Hit:2 http://archive.ubuntu.com/ubuntu groovy-updates InRelease
Hit:3 http://security.ubuntu.com/ubuntu groovy-security InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
<span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">0</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">0</span> not upgraded.
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ntpd_config<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> &gt; /etc/ntp.conf
 -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - cat /etc/ntp.conf -  
<span style="color:#75715e"># Pools for Gentoo users</span>
server 0.gentoo.pool.ntp.org
server 1.gentoo.pool.ntp.org
server 2.gentoo.pool.ntp.org
server 3.gentoo.pool.ntp.org
restrict default nomodify nopeer noquery limited kod
restrict 127.0.0.1
restrict <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>

&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - systemctl restart ntp -  
All <span style="color:#66d9ef">done</span>.
</code></pre></div><p>And you can skip hooks:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxd-compose apply my-first-project --disable-flag upgrade
Apply project my-first-project
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - echo <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ntpd_config<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> &gt; /etc/ntp.conf
 -  
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - cat /etc/ntp.conf -  
<span style="color:#75715e"># Pools for Gentoo users</span>
server 0.gentoo.pool.ntp.org
server 1.gentoo.pool.ntp.org
server 2.gentoo.pool.ntp.org
server 3.gentoo.pool.ntp.org
restrict default nomodify nopeer noquery limited kod
restrict 127.0.0.1
restrict <span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>

&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - systemctl restart ntp -  
All <span style="color:#66d9ef">done</span>.
</code></pre></div><h4 id="destroy-the-project">
  Destroy the project
  <a class="anchor" href="#destroy-the-project">#</a>
</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxd-compose destroy my-first-project
&gt;&gt;&gt; <span style="color:#f92672">[</span>node1<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span>stopped<span style="color:#f92672">]</span>  
All <span style="color:#66d9ef">done</span>.
</code></pre></div><blockquote class="book-hint info">
  Now you are ready to create your project! If it could be something that help
people you can share it with the community
through a PR at <a href="https://github.com/MottainaiCI/lxd-compose-galaxy/">LXD Compose Galaxy</a>.
</blockquote>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div>
    <a class="flex align-center" href="https://github.com/MottainaiCI/lxd-compose-docs/edit/master/site/content/docs/tutorial.md" target="_blank" rel="noopener">
      <img src="/lxd-compose-docs/svg/edit.svg" class="book-icon" alt="Edit" />
      <span></span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  

  </div><!-- Footer Section Start -->
<footer id="footer">
  <div class="container">
    <div class="row content-justify-between">
      <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
        <p class="copyright">Copyright:
          <span>
            <script>
              document.write(new Date().getFullYear())
            </script>
          </span> Daniele Rondina All Rights Reserved
        </p>
      </div>
      <div class="col-md-4 col-12">
        <!-- Social Media -->
        <ul class="social text-center text-md-right text-lg-right">
          
          <li><a href="https://github.com/MottainaiCI/lxd-compose"><i class="ion-social-github"></i></a></li>
          
          <li><a href="https://it.linkedin.com/in/danielerondina"><i class="ion-social-linkedin"></i></a></li>
          
          <li><a href="https://join.slack.com/t/mottainaici/shared_invite/zt-zdmrc651-IvxE9j~TT5ssv_CVo51uZg"><i class="ion-android-chat"></i></a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/jQurey/jquery.min.js"></script>
<!-- slick slider -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.js"></script>
<!-- wow js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://mottainaici.github.io/lxd-compose-docs/js/script.min.js"></script>
<!-- google analitycs -->
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'Your ID', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>












