<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  
  <meta name="description" content="LXD Compose">
  <meta name="author" content="Geaaru">
  <meta name="generator" content="Hugo 0.81.0" />
  
  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <link rel="icon" href="https://mottainaici.github.io/lxd-compose-docs/images/favicon.ico">

  <!-- Twitter Bootstrs CSS -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionicons Fonts Css -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/ionicons/ionicons.min.css">
  <!-- animate css -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/animate-css/animate.css">
  <!-- Hero area slider css-->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.css">
  <!-- slick slider -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.css">
  <!-- Fancybox -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.css">
  <!-- hover -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/hover/hover-min.css">
  <!-- template main css file -->
  
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/style.min.css" media="screen">
  
	<!-- Custom stylesheet - for your changes -->
	
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/custom.min.css" media="screen">
  
</head><head>
  <meta name="generator" content="Hugo 0.81.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="LXD Compose">
  <meta name="author" content="Geaaru">
  <meta name="generator" content="Hugo 0.81.0" />

<!-- Mobile Specific Metas -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<link rel="icon" href="https://mottainaici.github.io/lxd-compose-docs/images/favicon.ico">

<!-- Twitter Bootstrs CSS -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.css">
<!-- Ionicons Fonts Css -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/ionicons/ionicons.min.css">
<!-- animate css -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/animate-css/animate.css">
<!-- Hero area slider css-->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.css">
<!-- slick slider -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.css">
<!-- Fancybox -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.css">
<!-- hover -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/hover/hover-min.css">
<!-- template main css file -->

<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/style.min.css" media="screen">

  
<!-- Custom stylesheet - for your changes -->

<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/custom.min.css" media="screen"><meta property="og:title" content="" />
<meta property="og:description" content="LXD Compose &amp; VMWare #  The mission of this section is try to describe some use cases about using LXD Compose over a VMWare stack to supply production-ready services and help the systemist and developers life.
In particular, over my work experiences I saw a lot of different requirements exposed by my Clients. Just to help the reader I will try to describe in addition of the behavior of the specific use case what are the pro &amp; cons." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mottainaici.github.io/lxd-compose-docs/docs/vmware/" /><meta property="article:section" content="docs" />

<meta property="og:site_name" content="LXD Compose" />

<title>Vmware | LXD Compose</title>
<link rel="manifest" href="/lxd-compose-docs/manifest.json">
<link rel="icon" href="/lxd-compose-docs/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/lxd-compose-docs/book.min.2df5259632732379294ae606e78452d74cd92840b21effd36ae60304bd0bdc98.css" integrity="sha256-LfUlljJzI3kpSuYG54RS10zZKECyHv/TauYDBL0L3Jg=">
<script defer src="/lxd-compose-docs/en.search.min.27b54e922155d5697dffdceec08dd717d756ed2467ad925a6468463d742c0b69.js" integrity="sha256-J7VOkiFV1Wl9/9zuwI3XF9dW7SRnrZJaZGhGPXQsC2k="></script>

<script defer src="/lxd-compose-docs/sw.min.0232c72a126fed7e0676141811678c3a5a10a4fd735ed4b603233bbcb7f842a7.js" integrity="sha256-AjLHKhJv7X4GdhQYEWeMOloQpP1zXtS2AyM7vLf4Qqc="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head><section class="top-bar animated-header">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<nav class="navbar navbar-expand-lg navbar-light bg-light">
					<a class="navbar-brand" href="https://mottainaici.github.io/lxd-compose-docs/">
						<img src="https://mottainaici.github.io/lxd-compose-docs/images/logo.png" alt="LXD Compose">
					</a>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
						aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="navigation">
						<ul class="navbar-nav ml-auto">
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://mottainaici.github.io/lxd-compose-docs/">Home</a>
							</li>
							
							
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://mottainaici.github.io/lxd-compose-docs/docs">Documentation</a>
							</li>
							
							
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://github.com/MottainaiCI/lxd-compose/issues">Contact</a>
							</li>
							
							
						</ul>
					</div>
				</nav>
			</div>
		</div>
	</div>
</section><body dir="ltr">

  <div style="margin-top: 60px;">

  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li>
  <a href="/lxd-compose-docs/docs/"><strong>The Project</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/getting-started/"><strong>Getting Started</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/"><strong>Concepts</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/">Environments</a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#profiles">Profiles</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#networks">Networks</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#commands">Commands</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#storages">Storages</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/project/">Projects</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/group/">Groups</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/node/">Nodes</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/variable/">Variables</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/hook/">Hooks</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/"><strong>Template Engine</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/#jinja2-engine">Jinja2 Engine</a></li>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/#mottainai-engine">Mottainai Engine</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/render_engine/"><strong>Render Engine</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/"><strong>Tutorial</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#setup-lxd-environment">Step1: Install LXD</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-2-configure-lxd-client">Step2: Configure LXD Client</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-3-configure-lxd-compose-configuration-file">Step3: Configure LXD Compose configuration file</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-4-configure-lxd-profiles-and-networks">Step4: Configure LXD profiles and networks</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-5-create-your-first-project">Step5: Create your first project</a>
<br /></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/vmware/"class=active><strong>LXD Compose &amp; VMWare</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/galaxy/"><strong>LXD Compose Galaxy</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/galaxy/"><strong>Deploy Services on Raspberry Pi</strong></a></li>
</ul>
<p><br /></p>






  
<ul>
  
  <li>
    <a href="https://github.com/MottainaiCI/lxd-compose" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://join.slack.com/t/mottainaici/shared_invite/zt-zdmrc651-IvxE9j~TT5ssv_CVo51uZg" target="_blank" rel="noopener">
        Official Slack Channel
      </a>
  </li>
  
  <li>
    <a href="https://github.com/sponsors/geaaru" target="_blank" rel="noopener">
        Support our work!
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page" >
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/lxd-compose-docs/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Vmware</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="lxd-compose--vmware">
  LXD Compose &amp; VMWare
  <a class="anchor" href="#lxd-compose--vmware">#</a>
</h1>
<p>The mission of this section is try to describe some use cases about using
LXD Compose over a VMWare stack to supply production-ready services and
help the systemist and developers life.</p>
<p>In particular, over my work experiences I saw a lot of different requirements
exposed by my Clients. Just to help the reader I will try to describe in addition
of the behavior of the specific use case what are the pro &amp; cons.</p>
<p>One of these scenaries follow the idea of the 
  <a href="https://katacontainers.io/">Kata Containers</a>
where are used the VMWare VMs as nodes where install LXD standalone instances
where <code>lxd-compose</code> could be configured to delivery the services over 1 container for 1 VM.
Hereinafter, this use case is called <code>Vmware-LXD 1:1</code>.</p>
<h2 id="vmware-lxd-11">
  VMware-LXD 1:1
  <a class="anchor" href="#vmware-lxd-11">#</a>
</h2>
<p>In the 
  <a href="https://katacontainers.io/">Kata Containers</a> technology it&rsquo;s used
an Hardware Virtualization to supply an additional isolation with a lightweight VM
and individual kernels.</p>
<p>In a similar way the use case describe here try to use a single Linux VM over VmWare
where install a standalone LXD instance and then through <code>lxd-compose</code> deploy one or
more services using a Physical vNic that is managed by LXD and added from the VM
to the Container deployed.</p>
<p>
  <img src="../../images/lxdc-vmware-stack1.png#vmware" alt="LXD Compose Vmware Stack" /></p>
<p>As visible in the image every VM is configured with two differents vNICs.</p>
<p>A <code>management vNic/Iface</code> that is only available over the Host/VM
and it&rsquo;s used to communicate with LXD HTTPS API (normally over the 8443 port)
and/or for SSH access (VM packages upgrades, maintenance, etc.).
It&rsquo;s a good idea to reach this interface only over a private VPN.</p>
<p>A <code>service vNic/iface</code> that is used over the container to supply services
configured in the container.</p>
<p>To ensure a more clean setup of the host a best practices is to rename the network&rsquo;s
interface with a name more oriented with the target infrastructure. In the example,
it&rsquo;s used the name <code>srv0</code> defined in the LXD profile assigned to the container to
deploy. The same could be done for the management interface with a name like <code>man0</code>.</p>
<p>To rename the network interfaces it&rsquo;s needed create an udev rule based on the MAC
addresses assigned from VmWare to the VM. For example, editing the file
<code>/etc/udev/rules.d/70-persistent-net.rules</code>:</p>
<pre><code>SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR{address}==&quot;XX:XX:XX:XX:XX:XX&quot;, ATTR{dev_id}==&quot;0x0&quot;, ATTR{type}==&quot;1&quot;, KERNEL==&quot;eth*&quot;, NAME=&quot;man0&quot;
SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR{address}==&quot;XX:XX:XX:XX:XX:YY&quot;, ATTR{dev_id}==&quot;0x0&quot;, ATTR{type}==&quot;1&quot;, KERNEL==&quot;eth*&quot;, NAME=&quot;srv0&quot;
</code></pre><p>and then without the needed of reboot the VM just to execute:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$&gt; <span style="color:#75715e"># Ensure that the selected interface are down</span>
$&gt; ip link set eth0 down
$&gt; ip link set eth1 down
$&gt; udevadm control -R <span style="color:#f92672">&amp;&amp;</span> udevadm trigger --action<span style="color:#f92672">=</span>add -v -s net
</code></pre></div><p>When the VMs are all configured with LXD reachable over HTTPS the <code>lxd-compose</code>
tool will reach every nodes through the different <em>remotes</em>. The file
<code>lxd-conf/config.yml</code> will be configured in this way:</p>
<pre><code>default-remote: local
remotes:
  images:
    addr: https://images.linuxcontainers.org
    protocol: simplestreams
    public: true
  macaroni:
    addr: https://images.macaroni.funtoo.org/lxd-images
    protocol: simplestreams
    public: true
  local:
    addr: unix://
    public: false
  local-snapd:
    addr: unix:///var/snap/lxd/common/lxd/unix.socket
    public: false
  vm1:
    addr: https://vm1.infra:8443
    auth_type: tls
    project: default
    protocol: lxd
    public: false
  vm2:
    addr: https://vm2.infra:8443
    auth_type: tls
    project: default
    protocol: lxd
    public: false
aliases: {}

</code></pre><p>The remote <code>vm1</code> and <code>vm2</code> are the remotes of the VMs where deploy the
target services.</p>
<blockquote class="book-hint info">
  In this scenario to supply the classic HA services it&rsquo;s needed follow
exactly the steps that normally are follow on delivery HA service directly
over VMs. This means deploy multiple VMs with the same services (for example two
nodes for Nginx Server) and eventually using VIPs.
</blockquote>

<h3 id="best-practices-for-production-environments">
  Best Practices for Production environments
  <a class="anchor" href="#best-practices-for-production-environments">#</a>
</h3>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div>
    <a class="flex align-center" href="https://github.com/MottainaiCI/lxd-compose-docs/edit/master/site/content/docs/vmware.md" target="_blank" rel="noopener">
      <img src="/lxd-compose-docs/svg/edit.svg" class="book-icon" alt="Edit" />
      <span></span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  

  </div><!-- Footer Section Start -->
<footer id="footer">
  <div class="container">
    <div class="row content-justify-between">
      <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
        <p class="copyright">Copyright:
          <span>
            <script>
              document.write(new Date().getFullYear())
            </script>
          </span> Daniele Rondina All Rights Reserved
        </p>
      </div>
      <div class="col-md-4 col-12">
        <!-- Social Media -->
        <ul class="social text-center text-md-right text-lg-right">
          
          <li><a href="https://github.com/MottainaiCI/lxd-compose"><i class="ion-social-github"></i></a></li>
          
          <li><a href="https://it.linkedin.com/in/danielerondina"><i class="ion-social-linkedin"></i></a></li>
          
          <li><a href="https://join.slack.com/t/mottainaici/shared_invite/zt-zdmrc651-IvxE9j~TT5ssv_CVo51uZg"><i class="ion-android-chat"></i></a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/jQurey/jquery.min.js"></script>
<!-- slick slider -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.js"></script>
<!-- wow js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://mottainaici.github.io/lxd-compose-docs/js/script.min.js"></script>
<!-- google analitycs -->
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'Your ID', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>












