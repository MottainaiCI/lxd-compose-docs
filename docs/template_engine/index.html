<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  
  <meta name="description" content="LXD Compose">
  <meta name="author" content="Geaaru">
  <meta name="generator" content="Hugo 0.81.0" />
  
  <!-- Mobile Specific Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Template Engine</title>
  <link rel="icon" href="https://mottainaici.github.io/lxd-compose-docs/images/favicon.ico">

  <!-- Twitter Bootstrs CSS -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionicons Fonts Css -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/ionicons/ionicons.min.css">
  <!-- animate css -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/animate-css/animate.css">
  <!-- Hero area slider css-->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.css">
  <!-- slick slider -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.css">
  <!-- Fancybox -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.css">
  <!-- hover -->
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/hover/hover-min.css">
  <!-- template main css file -->
  
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/style.min.css" media="screen">
  
	<!-- Custom stylesheet - for your changes -->
	
  <link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/custom.min.css" media="screen">
  
</head><head>
  <meta name="generator" content="Hugo 0.81.0" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="LXD Compose">
  <meta name="author" content="Geaaru">
  <meta name="generator" content="Hugo 0.81.0" />

<!-- Mobile Specific Metas -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Template Engine</title>
<link rel="icon" href="https://mottainaici.github.io/lxd-compose-docs/images/favicon.ico">

<!-- Twitter Bootstrs CSS -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.css">
<!-- Ionicons Fonts Css -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/ionicons/ionicons.min.css">
<!-- animate css -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/animate-css/animate.css">
<!-- Hero area slider css-->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.css">
<!-- slick slider -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.css">
<!-- Fancybox -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.css">
<!-- hover -->
<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/plugins/hover/hover-min.css">
<!-- template main css file -->

<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/style.min.css" media="screen">

  
<!-- Custom stylesheet - for your changes -->

<link rel="stylesheet" href="https://mottainaici.github.io/lxd-compose-docs/css/custom.min.css" media="screen"><meta property="og:title" content="Template Engine" />
<meta property="og:description" content="Template Engine #  The term template engine is used in lxd-compose to identify the engine that is used to generate projects&rsquo;s files used in the deploy process but not related to the lxd-compose specification.
In the deploy process could be possible that we need to generate configuration files based on the project variables.
In lxd-compose there are two way to use the template engine:
  jinja2: through the tool j2cli it&rsquo;s possible to generate configuration files based on Jinja2 template engine." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mottainaici.github.io/lxd-compose-docs/docs/template_engine/" /><meta property="article:section" content="docs" />

<meta property="og:site_name" content="LXD Compose" />

<title>Template Engine | LXD Compose</title>
<link rel="manifest" href="/lxd-compose-docs/manifest.json">
<link rel="icon" href="/lxd-compose-docs/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/lxd-compose-docs/book.min.2df5259632732379294ae606e78452d74cd92840b21effd36ae60304bd0bdc98.css" integrity="sha256-LfUlljJzI3kpSuYG54RS10zZKECyHv/TauYDBL0L3Jg=">
<script defer src="/lxd-compose-docs/en.search.min.cd13276eb2c5eb9bb772f2690e2922d39a279f16bf6094536f16c47b877214ff.js" integrity="sha256-zRMnbrLF65u3cvJpDiki05onnxa/YJRTbxbEe4dyFP8="></script>

<script defer src="/lxd-compose-docs/sw.min.0232c72a126fed7e0676141811678c3a5a10a4fd735ed4b603233bbcb7f842a7.js" integrity="sha256-AjLHKhJv7X4GdhQYEWeMOloQpP1zXtS2AyM7vLf4Qqc="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head><section class="top-bar animated-header">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<nav class="navbar navbar-expand-lg navbar-light bg-light">
					<a class="navbar-brand" href="https://mottainaici.github.io/lxd-compose-docs/">
						<img src="https://mottainaici.github.io/lxd-compose-docs/images/logo.png" alt="LXD Compose">
					</a>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
						aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>

					<div class="collapse navbar-collapse" id="navigation">
						<ul class="navbar-nav ml-auto">
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://mottainaici.github.io/lxd-compose-docs/">Home</a>
							</li>
							
							
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://mottainaici.github.io/lxd-compose-docs/docs">Documentation</a>
							</li>
							
							
							
							<li class="nav-item">
								<a class="nav-link"
									href="https://github.com/MottainaiCI/lxd-compose/issues">Contact</a>
							</li>
							
							
						</ul>
					</div>
				</nav>
			</div>
		</div>
	</div>
</section><body dir="ltr">

  <div style="margin-top: 60px;">

  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>

<div class="book-search">
  <input type="text" id="book-search-input" placeholder="" aria-label="" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li>
  <a href="/lxd-compose-docs/docs/"><strong>The Project</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/getting-started/"><strong>Getting Started</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/"><strong>Concepts</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/">Environments</a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#profiles">Profiles</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#networks">Networks</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#commands">Commands</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/env/#storages">Storages</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/project/">Projects</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/group/">Groups</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/node/">Nodes</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/variable/">Variables</a></li>
<li>
  <a href="/lxd-compose-docs/docs/concepts/hook/">Hooks</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/"class=active><strong>Template Engine</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/#jinja2-engine">Jinja2 Engine</a></li>
<li>
  <a href="/lxd-compose-docs/docs/template_engine/#mottainai-engine">Mottainai Engine</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/render_engine/"><strong>Render Engine</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/"><strong>Tutorial</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#setup-lxd-environment">Step1: Install LXD</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-2-configure-lxd-client">Step2: Configure LXD Client</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-3-configure-lxd-compose-configuration-file">Step3: Configure LXD Compose configuration file</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-4-configure-lxd-profiles-and-networks">Step4: Configure LXD profiles and networks</a></li>
<li>
  <a href="/lxd-compose-docs/docs/tutorial/#step-5-create-your-first-project">Step5: Create your first project</a>
<br /></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/vmware/"><strong>LXD Compose &amp; VMWare</strong></a>
<ul>
<li>
  <a href="/lxd-compose-docs/docs/vmware-1-1/">VmWare-LXD 1:1</a></li>
</ul>
</li>
<li>
  <a href="/lxd-compose-docs/docs/galaxy/"><strong>LXD Compose Galaxy</strong></a></li>
<li>
  <a href="/lxd-compose-docs/docs/galaxy/"><strong>Deploy Services on Raspberry Pi</strong></a></li>
</ul>
<p><br /></p>






  
<ul>
  
  <li>
    <a href="https://github.com/MottainaiCI/lxd-compose" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://join.slack.com/t/mottainaici/shared_invite/zt-zdmrc651-IvxE9j~TT5ssv_CVo51uZg" target="_blank" rel="noopener">
        Official Slack Channel
      </a>
  </li>
  
  <li>
    <a href="https://github.com/sponsors/geaaru" target="_blank" rel="noopener">
        Support our work!
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page" >
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/lxd-compose-docs/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Template Engine</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="template-engine">
  Template Engine
  <a class="anchor" href="#template-engine">#</a>
</h1>
<p>The term <code>template engine</code> is used in <code>lxd-compose</code> to identify
the engine that is used to generate projects&rsquo;s files used in the
deploy process but not related to the <code>lxd-compose</code> specification.</p>
<p>In the deploy process could be possible that we need to generate
configuration files based on the project variables.</p>
<p>In <code>lxd-compose</code> there are two way to use the template engine:</p>
<ul>
<li>
<p><code>jinja2</code>: through the tool <code>j2cli</code> it&rsquo;s possible to generate
configuration files based on Jinja2 template engine.</p>
</li>
<li>
<p><code>mottainai</code>: this doesn&rsquo;t require external tool from the system.
It use golang template engine with additiona <em>macro</em>
from the Mottainai project and from 
  <a href="https://github.com/Masterminds/sprig">sprig</a>.</p>
</li>
</ul>
<p>The generation of the files from the template engine is done from
the <code>config_templates</code> option available at project level, group level
or node level.</p>
<p>If there aren&rsquo;t variables defined at runtime through the hooks it&rsquo;s possible
testing compilation of the templates without container with the command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$&gt; lxd-compose compile -p nginx-proxy
&gt;&gt;&gt; <span style="color:#f92672">[</span>nginx1<span style="color:#f92672">]</span> Compile <span style="color:#ae81ff">1</span> resources... 🍦
&gt;&gt;&gt; <span style="color:#f92672">[</span>nginx1<span style="color:#f92672">]</span> - <span style="color:#f92672">[</span> 1/ 1<span style="color:#f92672">]</span> /tmp/nginx/nginx.conf ✔
Compilation completed!
</code></pre></div><p>If you have variables generated through the hooks it&rsquo;s possible to use
the <code>lxd-compose compile</code> commands but the missing variables will be empty.</p>
<h2 id="jinja2-engine">
  Jinja2 Engine
  <a class="anchor" href="#jinja2-engine">#</a>
</h2>
<p>The <code>jinja2</code> engine is the same engine used by Ansible. It requires
the 
  <a href="https://github.com/kolypto/j2cli">j2cli</a> tool installed.</p>
<p>More details about jinja engine are available in the project

  <a href="https://jinja.palletsprojects.com/en/2.11.x/">site</a>.</p>
<p>The engine is defined at environment level in this way:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">template_engine</span>:
  <span style="color:#f92672">engine</span>: <span style="color:#e6db74">&#34;jinja2&#34;</span>
  <span style="color:#75715e"># For jinja2 there are a lot filter in ansible package</span>
  <span style="color:#75715e"># that could be loaded with:</span>
  <span style="color:#f92672">opts</span>:
    <span style="color:#75715e"># Enable to_yaml, to_json, etc.</span>
    - <span style="color:#e6db74">&#34;--filters&#34;</span>
    - <span style="color:#e6db74">&#34;/usr/lib/python3.7/site-packages/ansible/plugins/filter/core.py&#34;</span>
    - <span style="color:#e6db74">&#34;contrib/filters/from_json.py&#34;</span>
</code></pre></div><p>How described in the <code>j2cli</code> documentation it&rsquo;s possible to add
additional plugin to extend the available macro to use in your
template files.</p>
<p>In the example, they are used the Ansible macros and a custom filter.</p>
<p>When the engine configuration is done you can define the files to generate
inside the <code>config_templates</code> section in this way:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># List of templates files to compiles before push the</span>
<span style="color:#75715e"># result inside container.</span>
<span style="color:#f92672">config_templates</span>:
  - <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/template.j2</span>
    <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">files/myconf.yaml</span>
</code></pre></div><p>where <code>files/template.j2</code> is the template file and the <code>files/myconf.yaml</code> is
the generated file that could be used later with the <code>sync_resources</code> to push
the file directly in the container.</p>
<p>The template file (in this case <code>template.j2</code>) could be something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tmpl" data-lang="tmpl">node:
# This creates node information of lxd-compose specification in YAML format.
{{ node | to_nice_yaml(indent=2) | indent(2, true) }}

project:
# This creates project information of lxd-compose specification in YAML format.
{{ project | to_nice_yaml(indent=2) | indent(2, true) }}

# key1 and key2 are defined as variable of the project or generated by hooks.
key1: {{ key1 }}
key2: {{ key2 }}

# key_from_file1 is a variable defined inside the variable file.
key_from_file: {{ key_from_file1 }}

{{ json_var | from_json | to_nice_yaml(indent=2) | indent(2, true) }}

{% for user in json_var | from_json %}
{{ user.user }}
{% endfor %}
</code></pre></div><p>This an example of one of the included variables files:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">envs</span>:
  <span style="color:#f92672">key_from_file1</span>: <span style="color:#e6db74">&#34;xx&#34;</span>
</code></pre></div><p>There isn&rsquo;t a limitation about the types of files to generate.
You can generate YAML file, JSON file, etc.</p>
<details >
  <summary>Generated output</summary>
  <div class="markdown-inner">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">$ cat contrib/examples/envs/files/myconf.conf.yaml </span>
<span style="color:#f92672">node</span>:
  <span style="color:#f92672">config_templates</span>:
  - <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">files/myconf.conf.yaml</span>
    <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/template.j2</span>
  <span style="color:#f92672">entrypoint</span>:
  - <span style="color:#ae81ff">/bin/sh</span>
  - -<span style="color:#ae81ff">c</span>
  <span style="color:#f92672">hooks</span>:
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;Run host command&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;1&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">apk add curl</span>
    - <span style="color:#ae81ff">curl --no-pregress-meter https://raw.githubusercontent.com/geaaru/luet/geaaru/contrib/config/get_luet_root.sh | sh</span>
    - <span style="color:#ae81ff">luet install utils/jq</span>
    - <span style="color:#ae81ff">echo &#34;${node}&#34; | jq</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;HOST PRE-NODE-SYNC&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">pre-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;Start app&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
    <span style="color:#f92672">out2var</span>: <span style="color:#ae81ff">myvar</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${myvar}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${key1}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${obj}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${mynode_data1}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;HOST ${myvar}&#34;</span>
    - <span style="color:#ae81ff">echo &#34;${myvar}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${myvar}&#34; &gt; /tmp/lxd-compose-var</span>
    <span style="color:#f92672">entrypoint</span>:
    - <span style="color:#ae81ff">/bin/bash</span>
    - -<span style="color:#ae81ff">c</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">flags</span>:
    - <span style="color:#ae81ff">flag1</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#e6db74">&#39;echo &#39;&#39;{ &#34;obj1&#34;: &#34;value1&#34; }&#39;&#39; | jq &#39;&#39;.obj1&#39;&#39;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">      &#39;</span>
    <span style="color:#f92672">entrypoint</span>:
    - <span style="color:#ae81ff">/bin/bash</span>
    - -<span style="color:#ae81ff">c</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">flags</span>:
    - <span style="color:#ae81ff">flag2</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">out2var</span>: <span style="color:#ae81ff">host_var</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${host_var}&#34;</span>
    <span style="color:#f92672">entrypoint</span>:
    - <span style="color:#ae81ff">/bin/bash</span>
    - -<span style="color:#ae81ff">c</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">flags</span>:
    - <span style="color:#ae81ff">flag2</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${json_var}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#ae81ff">echo &#34;${runtime_var}&#34;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
    <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
  <span style="color:#f92672">image_source</span>: <span style="color:#ae81ff">alpine/3.12</span>
  <span style="color:#f92672">labels</span>:
    <span style="color:#f92672">mynode_data1</span>: <span style="color:#ae81ff">data1</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">node1</span>
  <span style="color:#f92672">sync_resources</span>:
  - <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">/etc/myapp/myconf.conf.yaml</span>
    <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/myconf.conf.yaml</span>
  - <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">/etc/myapp2/</span>
    <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/</span>


<span style="color:#f92672">project</span>:
  <span style="color:#f92672">description</span>: <span style="color:#ae81ff">LXD Compose Example1</span>
  <span style="color:#f92672">groups</span>:
  - <span style="color:#f92672">common_profiles</span>:
    - <span style="color:#ae81ff">default</span>
    - <span style="color:#ae81ff">net-mottainai0</span>
    <span style="color:#f92672">connection</span>: <span style="color:#ae81ff">local</span>
    <span style="color:#f92672">description</span>: <span style="color:#ae81ff">Description1</span>
    <span style="color:#f92672">ephemeral</span>: <span style="color:#66d9ef">true</span>
    <span style="color:#f92672">hooks</span>:
    - <span style="color:#f92672">commands</span>:
      - <span style="color:#ae81ff">echo &#34;HOST PRE-NODE-SYNC (ON GROUP)&#34;</span>
      <span style="color:#f92672">event</span>: <span style="color:#ae81ff">pre-node-sync</span>
      <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">group1</span>
    <span style="color:#f92672">nodes</span>:
    - <span style="color:#f92672">config_templates</span>:
      - <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">files/myconf.conf.yaml</span>
        <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/template.j2</span>
      <span style="color:#f92672">entrypoint</span>:
      - <span style="color:#ae81ff">/bin/sh</span>
      - -<span style="color:#ae81ff">c</span>
      <span style="color:#f92672">hooks</span>:
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;Run host command&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
        <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;1&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">apk add curl</span>
        - <span style="color:#ae81ff">curl https://raw.githubusercontent.com/geaaru/luet/geaaru/contrib/config/get_luet_root.sh | sh</span>
        - <span style="color:#ae81ff">luet install utils/jq</span>
        - <span style="color:#ae81ff">echo &#34;${node}&#34; | jq</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-creation</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;HOST PRE-NODE-SYNC&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">pre-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;Start app&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
        <span style="color:#f92672">out2var</span>: <span style="color:#ae81ff">myvar</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${myvar}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${key1}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${obj}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${mynode_data1}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;HOST ${myvar}&#34;</span>
        - <span style="color:#ae81ff">echo &#34;${myvar}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${myvar}&#34; &gt; /tmp/lxd-compose-var</span>
        <span style="color:#f92672">entrypoint</span>:
        - <span style="color:#ae81ff">/bin/bash</span>
        - -<span style="color:#ae81ff">c</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">flags</span>:
        - <span style="color:#ae81ff">flag1</span>
        <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#e6db74">&#39;echo &#39;&#39;{ &#34;obj1&#34;: &#34;value1&#34; }&#39;&#39; | jq &#39;&#39;.obj1&#39;&#39;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">          &#39;</span>
        <span style="color:#f92672">entrypoint</span>:
        - <span style="color:#ae81ff">/bin/bash</span>
        - -<span style="color:#ae81ff">c</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">flags</span>:
        - <span style="color:#ae81ff">flag2</span>
        <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
        <span style="color:#f92672">out2var</span>: <span style="color:#ae81ff">host_var</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${host_var}&#34;</span>
        <span style="color:#f92672">entrypoint</span>:
        - <span style="color:#ae81ff">/bin/bash</span>
        - -<span style="color:#ae81ff">c</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">flags</span>:
        - <span style="color:#ae81ff">flag2</span>
        <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${json_var}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      - <span style="color:#f92672">commands</span>:
        - <span style="color:#ae81ff">echo &#34;${runtime_var}&#34;</span>
        <span style="color:#f92672">event</span>: <span style="color:#ae81ff">post-node-sync</span>
        <span style="color:#f92672">node</span>: <span style="color:#e6db74">&#39;&#39;</span>
      <span style="color:#f92672">image_source</span>: <span style="color:#ae81ff">alpine/3.12</span>
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">mynode_data1</span>: <span style="color:#ae81ff">data1</span>
      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">node1</span>
      <span style="color:#f92672">sync_resources</span>:
      - <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">/etc/myapp/myconf.conf.yaml</span>
        <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/myconf.conf.yaml</span>
      - <span style="color:#f92672">dst</span>: <span style="color:#ae81ff">/etc/myapp2/</span>
        <span style="color:#f92672">source</span>: <span style="color:#ae81ff">files/</span>
  <span style="color:#f92672">hooks</span>:
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#e6db74">&#39;echo &#39;&#39;[{ &#34;user&#34;: &#34;user1&#34; }]&#39;&#39;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">      &#39;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">pre-group</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">out2var</span>: <span style="color:#ae81ff">json_var</span>
  - <span style="color:#f92672">commands</span>:
    - <span style="color:#e6db74">&#39;echo &#39;&#39;[{ &#34;user&#34;: &#34;user1&#34; }]&#39;&#39;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">      &#39;</span>
    <span style="color:#f92672">event</span>: <span style="color:#ae81ff">pre-group</span>
    <span style="color:#f92672">node</span>: <span style="color:#ae81ff">host</span>
    <span style="color:#f92672">out2var</span>: <span style="color:#ae81ff">json_var</span>
  <span style="color:#f92672">include_env_files</span>:
  - <span style="color:#ae81ff">../vars/file1.yml</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">lxd-compose-example1</span>
  <span style="color:#f92672">vars</span>:
  - <span style="color:#f92672">envs</span>:
      <span style="color:#f92672">LUET_YES</span>: <span style="color:#e6db74">&#39;true&#39;</span>
      <span style="color:#f92672">key1</span>: <span style="color:#ae81ff">value1</span>
      <span style="color:#f92672">key2</span>: <span style="color:#ae81ff">value2</span>
      <span style="color:#f92672">obj</span>:
        <span style="color:#f92672">foo</span>: <span style="color:#ae81ff">baa</span>
        <span style="color:#f92672">key</span>: <span style="color:#ae81ff">xxx</span>
  - <span style="color:#f92672">envs</span>:
      <span style="color:#f92672">json_var</span>: <span style="color:#e6db74">&#39;[{ &#34;user&#34;: &#34;user1&#34; }]
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        &#39;</span>
      <span style="color:#f92672">key_from_file1</span>: <span style="color:#ae81ff">xx</span>


<span style="color:#f92672">key1</span>: <span style="color:#ae81ff">value1</span>
<span style="color:#f92672">key2</span>: <span style="color:#ae81ff">value2</span>

<span style="color:#f92672">key_from_file</span>: <span style="color:#ae81ff">xx</span>

  - <span style="color:#f92672">user</span>: <span style="color:#ae81ff">user1</span>



<span style="color:#ae81ff">user1</span>
</code></pre></div>
  </div>
</details>

<h2 id="mottainai-engine">
  Mottainai Engine
  <a class="anchor" href="#mottainai-engine">#</a>
</h2>
<p>In a similar way, the <code>mottainai</code> engine could be used to generate files used
in the deploy workflow.</p>
<p>It&rsquo;s used the Golang 
  <a href="https://golang.org/pkg/text/template/">template engine</a> with
additional <em>functions</em> from 
  <a href="https://github.com/MottainaiCI/mottainai-server/blob/master/mottainai-cli/cmd/task/template/template.go#L91">Mottainai Server project</a> and
from 
  <a href="http://masterminds.github.io/sprig/">sprig</a>.</p>
<p>This engine doesn&rsquo;t require external tools.</p>
<p>Hereinafter, an example related to an NGINX configuration:</p>
<details >
  <summary>nginx.conf.tmpl</summary>
  <div class="markdown-inner">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tmpl" data-lang="tmpl">user {{ .nginx_user }};
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
  worker_connections 1024;
  use epoll;
}

http {
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  log_format main
    &#39;<span style="color:#75715e">$</span>remote_addr - <span style="color:#75715e">$</span>remote_user [<span style="color:#75715e">$</span>time_local] &#39;
    &#39;&#34;<span style="color:#75715e">$</span>request&#34; <span style="color:#75715e">$</span>status <span style="color:#75715e">$</span>bytes_sent &#39;
    &#39;&#34;<span style="color:#75715e">$</span>http_referer&#34; &#34;<span style="color:#75715e">$</span>http_user_agent&#34; &#39;
    &#39;&#34;<span style="color:#75715e">$</span>gzip_ratio&#34;&#39;;

  client_header_timeout 10m;
  client_body_timeout 10m;
  send_timeout 10m;

  connection_pool_size 256;
  client_header_buffer_size 1k;
  large_client_header_buffers 4 2k;
  request_pool_size 4k;

  gzip off;

  output_buffers 1 32k;
  postpone_output 1460;

  sendfile on;
  tcp_nopush on;
  tcp_nodelay on;

  keepalive_timeout 75 20;

  ignore_invalid_headers on;

  index index.html;

  proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=mattermost_cache:10m max_size=3g inactive=120m use_temp_path=off;

  {{ range <span style="color:#75715e">$</span>index, <span style="color:#75715e">$</span>upstream := .nginx_upstreams }}
  upstream {{ index <span style="color:#75715e">$</span>upstream &#34;name&#34; }} {
    server {{ index <span style="color:#75715e">$</span>upstream &#34;server&#34; }};
    keepalive {{ index <span style="color:#75715e">$</span>upstream &#34;keepalive&#34; }};
  }
  {{ end }}


  server {
    listen 80;
    server_name    {{ .mypublic_domain }};
    server_tokens off;

    access_log /var/log/nginx/access_log main;
    error_log /var/log/nginx/error_log info;

    {{ range <span style="color:#75715e">$</span>index, <span style="color:#75715e">$</span>loc := .nginx_location_http }}

    location {{ index <span style="color:#75715e">$</span>loc &#34;path&#34; }} {
      {{ index <span style="color:#75715e">$</span>loc &#34;content&#34; }}
    }
    {{ end }}
  }

  server {
     listen 443 ssl;
     server_name    {{ .mypublic_domain }};
     server_tokens off;

     ssl_certificate /certbot/live/{{ .mypublic_domain }}/fullchain.pem;
     <span style="color:#75715e">#ssl</span>_certificate <span style="color:#f92672">/</span>certbot<span style="color:#f92672">/</span>live<span style="color:#f92672">/</span>{{ <span style="color:#f92672">.</span>mypublic_domain }}<span style="color:#f92672">/</span>cert<span style="color:#f92672">.</span>pem;
     ssl_certificate_key /certbot/live/{{ .mypublic_domain }}/privkey.pem;

     access_log /var/log/nginx/ssl_access_log main;
     error_log /var/log/nginx/ssl_error_log info;

     {{ range <span style="color:#75715e">$</span>index, <span style="color:#75715e">$</span>loc := .nginx_location_ssl }}

     location {{ index <span style="color:#75715e">$</span>loc &#34;path&#34; }} {
        {{ index <span style="color:#75715e">$</span>loc &#34;content&#34; | nindent 10 }}
     }
     {{ end }}

     root   /var/www/html;
  }
}

</code></pre></div><p>If we consider a variable file like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">envs</span>:
  <span style="color:#f92672">nginx_user</span>: <span style="color:#ae81ff">www-data</span>
  <span style="color:#f92672">nginx_logrotate_days</span>: <span style="color:#ae81ff">30</span>

  <span style="color:#f92672">nginx_upstreams</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">upstream1</span>
      <span style="color:#f92672">server</span>: <span style="color:#ae81ff">192.168.0.90</span>:<span style="color:#ae81ff">8065</span>
      <span style="color:#f92672">keepalive</span>: <span style="color:#ae81ff">32</span>

  <span style="color:#f92672">nginx_reset_htpasswd</span>: <span style="color:#e6db74">&#34;1&#34;</span>
  <span style="color:#f92672">nginx_auth_basic_files</span>:
    - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/etc/nginx/myauth</span>
      <span style="color:#f92672">users</span>:
        - <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;user1&#34;</span>
          <span style="color:#f92672">pwd</span>: <span style="color:#e6db74">&#34;xxxxxx&#34;</span>
        - <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;user2&#34;</span>
          <span style="color:#f92672">pwd</span>: <span style="color:#e6db74">&#34;yyyyy&#34;</span>

  <span style="color:#f92672">nginx_location_http</span>:
    - <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;/&#34;</span>
      <span style="color:#f92672">content</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">       </span>       <span style="color:#ae81ff">deny all;</span>
  <span style="color:#f92672">nginx_location_ssl</span>:
    - <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;/&#34;</span>
      <span style="color:#f92672">content</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">       </span>       <span style="color:#ae81ff">deny all;</span>
    - <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;/public/&#34;</span>
      <span style="color:#f92672">content</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">        </span>        <span style="color:#ae81ff">allow all;</span>
    - <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;/private/&#34;</span>
      <span style="color:#f92672">content</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">        satisfy all;
</span><span style="color:#e6db74">        #allow 192.168.0.0/24;
</span><span style="color:#e6db74">        #deny all;
</span><span style="color:#e6db74">        index index.htm;
</span><span style="color:#e6db74">        auth_basic  &#34;Restricted Area&#34;;
</span><span style="color:#e6db74">        auth_basic_user_file /etc/nginx/myauth;</span>        
</code></pre></div>
  </div>
</details>

<p>the output generated is something like available below:</p>
<details >
  <summary>Generated output</summary>
  <div class="markdown-inner">
    <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events <span style="color:#75715e">{</span>
  <span style="color:#a6e22e">worker_connections</span> <span style="color:#ae81ff">1024</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">use</span> <span style="color:#a6e22e">epoll</span><span style="color:#f92672">;</span>
<span style="color:#75715e">}</span>

http <span style="color:#75715e">{</span>
  <span style="color:#a6e22e">include</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">mime</span><span style="color:#f92672">.</span><span style="color:#a6e22e">types</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">default_type</span> <span style="color:#a6e22e">application</span><span style="color:#f92672">/</span><span style="color:#a6e22e">octet</span><span style="color:#f92672">-</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">log_format</span> <span style="color:#a6e22e">main</span>
    <span style="color:#e6db74">&#39;$remote_addr - $remote_user [$time_local] &#39;</span>
    <span style="color:#e6db74">&#39;&#34;$request&#34; $status $bytes_sent &#39;</span>
    <span style="color:#e6db74">&#39;&#34;$http_referer&#34; &#34;$http_user_agent&#34; &#39;</span>
    <span style="color:#e6db74">&#39;&#34;$gzip_ratio&#34;&#39;</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">client_header_timeout</span> <span style="color:#ae81ff">10</span><span style="color:#a6e22e">m</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">client_body_timeout</span> <span style="color:#ae81ff">10</span><span style="color:#a6e22e">m</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">send_timeout</span> <span style="color:#ae81ff">10</span><span style="color:#a6e22e">m</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">connection_pool_size</span> <span style="color:#ae81ff">256</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">client_header_buffer_size</span> <span style="color:#ae81ff">1</span><span style="color:#a6e22e">k</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">large_client_header_buffers</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">2</span><span style="color:#a6e22e">k</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">request_pool_size</span> <span style="color:#ae81ff">4</span><span style="color:#a6e22e">k</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">gzip</span> <span style="color:#a6e22e">off</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">output_buffers</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">32</span><span style="color:#a6e22e">k</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">postpone_output</span> <span style="color:#ae81ff">1460</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">sendfile</span> <span style="color:#a6e22e">on</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">tcp_nopush</span> <span style="color:#a6e22e">on</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">tcp_nodelay</span> <span style="color:#a6e22e">on</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">keepalive_timeout</span> <span style="color:#ae81ff">75</span> <span style="color:#ae81ff">20</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">ignore_invalid_headers</span> <span style="color:#a6e22e">on</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">index</span> <span style="color:#a6e22e">index</span><span style="color:#f92672">.</span><span style="color:#a6e22e">html</span><span style="color:#f92672">;</span>

  <span style="color:#a6e22e">proxy_cache_path</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cache</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span> <span style="color:#a6e22e">levels</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span> <span style="color:#a6e22e">keys_zone</span><span style="color:#f92672">=</span><span style="color:#a6e22e">mattermost_cache</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span><span style="color:#a6e22e">m</span> <span style="color:#a6e22e">max_size</span><span style="color:#f92672">=</span><span style="color:#ae81ff">3</span><span style="color:#a6e22e">g</span> <span style="color:#a6e22e">inactive</span><span style="color:#f92672">=</span><span style="color:#ae81ff">120</span><span style="color:#a6e22e">m</span> <span style="color:#a6e22e">use_temp_path</span><span style="color:#f92672">=</span><span style="color:#a6e22e">off</span><span style="color:#f92672">;</span>

  
  <span style="color:#a6e22e">upstream</span> <span style="color:#a6e22e">upstream1</span> <span style="color:#75715e">{</span>
    <span style="color:#a6e22e">server</span> <span style="color:#ae81ff">192.168</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.90</span><span style="color:#f92672">:</span><span style="color:#ae81ff">8065</span><span style="color:#f92672">;</span>
    <span style="color:#a6e22e">keepalive</span> <span style="color:#ae81ff">32</span><span style="color:#f92672">;</span>
  <span style="color:#75715e">}</span>
  


  <span style="color:#a6e22e">server</span> <span style="color:#75715e">{</span>
    <span style="color:#a6e22e">listen</span> <span style="color:#ae81ff">80</span><span style="color:#f92672">;</span>
    <span style="color:#a6e22e">server_name</span>    <span style="color:#a6e22e">example1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">com</span><span style="color:#f92672">;</span>
    <span style="color:#a6e22e">server_tokens</span> <span style="color:#a6e22e">off</span><span style="color:#f92672">;</span>

    <span style="color:#a6e22e">access_log</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">log</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">access_log</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">;</span>
    <span style="color:#a6e22e">error_log</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">log</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">error_log</span> <span style="color:#a6e22e">info</span><span style="color:#f92672">;</span>

    

    <span style="color:#a6e22e">location</span> <span style="color:#f92672">/</span> <span style="color:#75715e">{</span>
      <span style="color:#a6e22e">deny</span> <span style="color:#a6e22e">all</span><span style="color:#f92672">;</span>

    <span style="color:#75715e">}</span>
    
  <span style="color:#75715e">}</span>

  <span style="color:#a6e22e">server</span> <span style="color:#75715e">{</span>
     <span style="color:#a6e22e">listen</span> <span style="color:#ae81ff">443</span> <span style="color:#a6e22e">ssl</span><span style="color:#f92672">;</span>
     <span style="color:#a6e22e">server_name</span>    <span style="color:#a6e22e">example1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">com</span><span style="color:#f92672">;</span>
     <span style="color:#a6e22e">server_tokens</span> <span style="color:#a6e22e">off</span><span style="color:#f92672">;</span>

     <span style="color:#a6e22e">ssl_certificate</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">certbot</span><span style="color:#f92672">/</span><span style="color:#a6e22e">live</span><span style="color:#f92672">/</span><span style="color:#a6e22e">example1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">fullchain</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pem</span><span style="color:#f92672">;</span>
     <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">ssl_certificate</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">certbot</span><span style="color:#f92672">/</span><span style="color:#a6e22e">live</span><span style="color:#f92672">/</span><span style="color:#a6e22e">example1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cert</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pem</span><span style="color:#f92672">;</span>
     <span style="color:#a6e22e">ssl_certificate_key</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">certbot</span><span style="color:#f92672">/</span><span style="color:#a6e22e">live</span><span style="color:#f92672">/</span><span style="color:#a6e22e">example1</span><span style="color:#f92672">.</span><span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">privkey</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pem</span><span style="color:#f92672">;</span>

     <span style="color:#a6e22e">access_log</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">log</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">ssl_access_log</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">;</span>
     <span style="color:#a6e22e">error_log</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">log</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">ssl_error_log</span> <span style="color:#a6e22e">info</span><span style="color:#f92672">;</span>

     

     <span style="color:#a6e22e">location</span> <span style="color:#f92672">/</span> <span style="color:#75715e">{</span>
        
          <span style="color:#a6e22e">deny</span> <span style="color:#a6e22e">all</span><span style="color:#f92672">;</span>
          
     <span style="color:#75715e">}</span>
     

     <span style="color:#a6e22e">location</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">public</span><span style="color:#f92672">/</span> <span style="color:#75715e">{</span>
        
          <span style="color:#a6e22e">allow</span> <span style="color:#a6e22e">all</span><span style="color:#f92672">;</span>
          
     <span style="color:#75715e">}</span>
     

     <span style="color:#a6e22e">location</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">private</span><span style="color:#f92672">/</span> <span style="color:#75715e">{</span>
        
          <span style="color:#a6e22e">satisfy</span> <span style="color:#a6e22e">all</span><span style="color:#f92672">;</span>
          <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">allow</span> <span style="color:#ae81ff">192.168</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0.0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">24</span><span style="color:#f92672">;</span>
          <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">deny</span> <span style="color:#a6e22e">all</span><span style="color:#f92672">;</span>
          <span style="color:#a6e22e">index</span> <span style="color:#a6e22e">index</span><span style="color:#f92672">.</span><span style="color:#a6e22e">htm</span><span style="color:#f92672">;</span>
          <span style="color:#a6e22e">auth_basic</span>  <span style="color:#e6db74">&#34;Restricted Area&#34;</span><span style="color:#f92672">;</span>
          <span style="color:#a6e22e">auth_basic_user_file</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span><span style="color:#f92672">/</span><span style="color:#a6e22e">myauth</span><span style="color:#f92672">;</span>
          
     <span style="color:#75715e">}</span>
     

     <span style="color:#a6e22e">root</span>   <span style="color:#f92672">/</span><span style="color:#a6e22e">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#f92672">/</span><span style="color:#a6e22e">html</span><span style="color:#f92672">;</span>
  <span style="color:#75715e">}</span>
<span style="color:#75715e">}</span>

</code></pre></div>
  </div>
</details>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div>
    <a class="flex align-center" href="https://github.com/MottainaiCI/lxd-compose-docs/edit/master/site/content/docs/template_engine.md" target="_blank" rel="noopener">
      <img src="/lxd-compose-docs/svg/edit.svg" class="book-icon" alt="Edit" />
      <span></span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  

  </div><!-- Footer Section Start -->
<footer id="footer">
  <div class="container">
    <div class="row content-justify-between">
      <div class="col-md-8 col-12 text-center text-lg-left text-md-left">
        <p class="copyright">Copyright:
          <span>
            <script>
              document.write(new Date().getFullYear())
            </script>
          </span> Daniele Rondina All Rights Reserved
        </p>
      </div>
      <div class="col-md-4 col-12">
        <!-- Social Media -->
        <ul class="social text-center text-md-right text-lg-right">
          
          <li><a href="https://github.com/MottainaiCI/lxd-compose"><i class="ion-social-github"></i></a></li>
          
          <li><a href="https://it.linkedin.com/in/danielerondina"><i class="ion-social-linkedin"></i></a></li>
          
          <li><a href="https://join.slack.com/t/mottainaici/shared_invite/zt-zdmrc651-IvxE9j~TT5ssv_CVo51uZg"><i class="ion-android-chat"></i></a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<!-- footer section end -->

<!-- jquery -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/jQurey/jquery.min.js"></script>
<!-- slick slider -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/bootstrap/bootstrap.min.js"></script>
<!-- wow js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="https://mottainaici.github.io/lxd-compose-docs/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="https://mottainaici.github.io/lxd-compose-docs/js/script.min.js"></script>
<!-- google analitycs -->
<script>
  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
  ga('create', 'Your ID', 'auto');
  ga('send', 'pageview');
</script>
</body>

</html>












